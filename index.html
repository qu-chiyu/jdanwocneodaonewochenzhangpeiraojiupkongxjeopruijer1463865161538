<!DOCTYPE html>
<html lang="ch-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é½¿ä½™è®¡ç®—å™¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        .calculator { max-width: 400px; margin: 50px auto; border: 2px solid #e0e0e0; border-radius: 12px; padding: 20px; position: relative; }
        .settings-btn { position: absolute; top: 8px; left: 15px; border: none; border-radius: 4px; padding: 4px 8px; font-size: 12px; cursor: pointer; z-index: 10; }
        .settings-btn:hover { opacity: 0.9; }
        #display { width: 100%; height: 80px; margin-bottom: 20px; padding: 15px; font-size: 28px; text-align: right; border: none; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        button { padding: 20px; font-size: 20px; border: none; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        button:hover { transform: scale(1.05); opacity: 0.9; }
        .operator { color: #333; }
        .equal { color: #333; grid-column: span 2; }
        .special { color: #333; }

        /* ç³»ç»Ÿé»˜è®¤é…è‰²ï¼ˆæ·±ç°èƒŒæ™¯ï¼‰ */
        .calculator.macaron { background: #333333; }
        .calculator.macaron #display { background: #444444; color: #ffffff; }
        .calculator.macaron button { background: #ffea7f; }
        .calculator.macaron .operator { background: #ffc1e9; }
        .calculator.macaron .equal { background: #b3e0ff; }
        .calculator.macaron .special { background: #c1ffd7; }
        .calculator.macaron .settings-btn { background: #555; color: #fff; }

        .calculator.gray-scale { background: #333333; }
        .calculator.gray-scale #display { background: #222; color: #fff; }
        .calculator.gray-scale button { background: #f5f5f5; color: #111; }
        .calculator.gray-scale .operator { background: #ccc; }
        .calculator.gray-scale .equal { background: #999; }
        .calculator.gray-scale .special { background: #bbb; }
        .calculator.gray-scale .settings-btn { background: #555; color: #fff; }

        .calculator.orange-yellow { background: #333333; }
        .calculator.orange-yellow #display { background: #2d2d2d; color: #e48e41; }
        .calculator.orange-yellow button { background: #fff3cd; color: #333; }
        .calculator.orange-yellow .operator { background: #ffc107; }
        .calculator.orange-yellow .equal { background: #fd7e14; }
        .calculator.orange-yellow .special { background: #ffecb3; }
        .calculator.orange-yellow .settings-btn { background: #555; color: #fff; }

        .calculator.white-blue { background: #333333; }
        .calculator.white-blue #display { background: #d4e4ef; color: #8abdd2; }
        .calculator.white-blue button { background: #f0f8ff; color: #0047ab; }
        .calculator.white-blue .operator { background: #b3e5fc; }
        .calculator.white-blue .equal { background: #81d4fa; }
        .calculator.white-blue .special { background: #e0f2fe; }
        .calculator.white-blue .settings-btn { background: #555; color: #fff; }

        .calculator.rainbow { background: #333333; }
        .calculator.rainbow #display { background: #444444; color: #2d2d2d; }
        .calculator.rainbow button { background: #ff6b6b; }
        .calculator.rainbow .operator { background: #ffd166; }
        .calculator.rainbow .equal { background: #06d6a0; }
        .calculator.rainbow .special { background: #118ab2; }
        .calculator.rainbow .settings-btn { background: #555; color: #fff; }

        /* æ˜¥é‡èŠ±å›­é…è‰²ï¼ˆä¸¥æ ¼åŒ¹é…å›¾ç‰‡æ ‡æ³¨+ä¼˜åŒ–æŒ‰é’®è‰²ï¼‰ */
        .calculator.spring-garden { 
            background: #f5f5dc; /* å›¾ç‰‡æ ‡æ³¨èƒŒæ™¯è‰²ï¼ˆæµ…é»„ç»¿ï¼‰ */
        }
        .calculator.spring-garden #display { 
            background: #f5f5dc; /* èƒŒæ™¯åŒè‰² */
            color: #c9a0dc; /* å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰²ï¼ˆæµ…ç´«ï¼‰ */
        }
        .calculator.spring-garden button { 
            background: #add8e6; /* å›¾ç‰‡æ ‡æ³¨æŒ‰é’®è‰²ï¼ˆæµ…è“è‰²ï¼‰ */
            color: #c9a0dc; /* æ‰€æœ‰æŒ‰é’®æ–‡å­—ç»Ÿä¸€ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        }
        .calculator.spring-garden .operator { 
            background: #ffc0cb; /* å›¾ç‰‡æ ‡æ³¨æŒ‰é’®è‰²ï¼ˆç²‰è‰²ï¼‰ */
            color: #c9a0dc; /* è¿ç®—ç¬¦æ–‡å­—ç»Ÿä¸€ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        }
        .calculator.spring-garden .equal { 
            background: #ffdab9; /* ä¼˜åŒ–æµ…æ©™è‰²ï¼ˆåŸæ©™è‰²å˜æµ…ï¼‰ */
            color: #c9a0dc; /* ç­‰å·æ–‡å­—ç»Ÿä¸€ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        }
        .calculator.spring-garden .special { 
            background: #ffe6f2; /* ç‰¹åˆ«æµ…ç²‰è‰²ï¼ˆC/%/âˆšæŒ‰é’®ï¼‰ */
            color: #c9a0dc; /* ç‰¹æ®ŠæŒ‰é’®æ–‡å­—ç»Ÿä¸€ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
            border: 1px solid #c9a0dc; /* è½»å¾®æè¾¹åŒºåˆ† */
        }
        .calculator.spring-garden .settings-btn { 
            background: #ffe6f2; /* è·Ÿç‰¹æ®ŠæŒ‰é’®åŒæµ…ç²‰è‰² */
            color: #c9a0dc; /* è®¾ç½®æŒ‰é’®æ–‡å­—ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        }

        .settings-page { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; align-items: center; justify-content: center; }
        .settings-content { background: #444; padding: 25px; border-radius: 10px; width: 320px; text-align: center; }
        .main-setting-btn { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 5px; cursor: pointer; color: #fff; font-size: 16px; background: #555; }
        .main-setting-btn:hover { background: #666; }
        .option-list { display: none; margin: 10px 0; gap: 6px; flex-direction: column; }
        .option-btn { width: 100%; padding: 10px; border: none; border-radius: 5px; cursor: pointer; color: #333; font-size: 14px; }
        .close-btn { width: 100%; padding: 10px; margin-top: 10px; background: #666; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
        .close-btn:hover { background: #777; }
        .maker-text { color: #fff; font-size: 14px; line-height: 1.6; margin: 15px 0; padding: 10px; background: #555; border-radius: 5px; }
        .history-list { max-height: 200px; overflow-y: auto; background: #555; border-radius: 5px; padding: 10px; margin: 10px 0; }
        .history-item { font-size: 14px; padding: 6px 0; border-bottom: 1px solid #666; text-align: left; }
        .history-item:last-child { border-bottom: none; }
        .clear-history-btn { color: #fff; margin-top: 8px; }
        .clear-history-btn:hover { opacity: 0.9; }
        .calculator.macaron .history-item { color: #b3e0ff; }
        .calculator.macaron .clear-history-btn { background: #b3e0ff; }
        .calculator.gray-scale .history-item { color: #999; }
        .calculator.gray-scale .clear-history-btn { background: #999; }
        .calculator.orange-yellow .history-item { color: #fd7e14; }
        .calculator.orange-yellow .clear-history-btn { background: #fd7e14; }
        .calculator.white-blue .history-item { color: #81d4fa; }
        .calculator.white-blue .clear-history-btn { background: #81d4fa; }
        .calculator.rainbow .history-item { color: #06d6a0; }
        .calculator.rainbow .clear-history-btn { background: #06d6a0; }
        .calculator.spring-garden .history-item { color: #c9a0dc; } /* å†å²è®°å½•æ–‡å­—ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        .calculator.spring-garden .clear-history-btn { 
            background: #ffe6f2; /* æ¸…ç©ºè®°å½•æŒ‰é’®ç”¨æµ…ç²‰è‰² */
            color: #c9a0dc; /* æ–‡å­—ç”¨å›¾ç‰‡æ ‡æ³¨å­—ä½“è‰² */
        }
        /* å­—ä½“æ ·å¼è¡¥å…… */
        .calculator.fancy-font button,
        .calculator.fancy-font #display,
        .calculator.smooth-fancy-font button,
        .calculator.smooth-fancy-font #display,
        .calculator.code-font button,
        .calculator.code-font #display,
        .calculator.art-font button,
        .calculator.art-font #display {
            font-family: inherit;
        }
        /* ç¤¾åŒºæ¨¡å—æ ·å¼ */
        .community-item { padding: 12px; background: #555; border-radius: 5px; color: #fff; text-align: left; margin-bottom: 8px; }
        .community-item-title { font-weight: bold; margin-bottom: 6px; }
        .community-download-btn { width: 100%; padding: 8px; background: #777; color: #fff; border: none; border-radius: 3px; cursor: pointer; margin-top: 8px; }
        .community-download-btn:hover { background: #888; }
    </style>
</head>
<body>
    <div class="calculator macaron">
        <button class="settings-btn" onclick="openSettings()">è®¾ç½®</button>
        <input type="text" id="display" readonly>
        <div class="buttons">
            <button class="special" onclick="clearDisplay()">C</button>
            <button class="special" onclick="appendToDisplay('%')">%</button>
            <button class="special" onclick="calculateSquareRoot()">âˆš</button>
            <button class="operator" onclick="appendToDisplay('/')">Ã·</button>
            <button onclick="appendToDisplay('7')">7</button>
            <button onclick="appendToDisplay('8')">8</button>
            <button onclick="appendToDisplay('9')">9</button>
            <button class="operator" onclick="appendToDisplay('*')">Ã—</button>
            <button onclick="appendToDisplay('4')">4</button>
            <button onclick="appendToDisplay('5')">5</button>
            <button onclick="appendToDisplay('6')">6</button>
            <button class="operator" onclick="appendToDisplay('-')">-</button>
            <button onclick="appendToDisplay('1')">1</button>
            <button onclick="appendToDisplay('2')">2</button>
            <button onclick="appendToDisplay('3')">3</button>
            <button class="operator" onclick="appendToDisplay('+')">+</button>
            <button onclick="appendToDisplay('0')">0</button>
            <button onclick="appendToDisplay('.')">.</button>
            <button class="equal" onclick="calculateResult()">=</button>
        </div>
    </div>
    <div class="settings-page" id="settingsPage">
        <div class="settings-content">
            <button class="main-setting-btn" onclick="toggleOptionList('colorOptions')">é…è‰²é€‰æ‹©</button>
            <div class="option-list" id="colorOptions">
                <button class="option-btn" onclick="changeColor('macaron')">é©¬å¡é¾™</button>
                <button class="option-btn" onclick="changeColor('gray-scale')">é»‘ç™½</button>
                <button class="option-btn" onclick="changeColor('orange-yellow')">æ©™é»„</button>
                <button class="option-btn" onclick="changeColor('white-blue')">ç™½è“è¯—æ„</button>
                <button class="option-btn" onclick="changeColor('rainbow')">å½©è™¹</button>
            </div>
            <button class="main-setting-btn" onclick="toggleOptionList('languageOptions')">è¯­è¨€é€‰æ‹©</button>
            <div class="option-list" id="languageOptions">
                <button class="option-btn" onclick="changeLanguage('zh')">å¤æ±‰èª</button>
                <button class="option-btn" onclick="changeLanguage('en')">English</button>
                <button class="option-btn" onclick="changeLanguage('jp')">æ—¥æœ¬èª</button>
                <button class="option-btn" onclick="changeLanguage('ch')">ä¸­æ–‡</button>
                <button class="option-btn" onclick="changeLanguage('lm')">ç½—é©¬</button>
            </div>
            <button class="main-setting-btn" onclick="toggleOptionList('fontOptions')">å­—ä½“è®¾ç½®</button>
            <div class="option-list" id="fontOptions">
                <button class="option-btn" onclick="changeFont('default')">é»˜è®¤å­—ä½“</button>
                <button class="option-btn" onclick="changeFont('fancy')">åä¸½ç§€ä½“</button>
                <button class="option-btn" onclick="changeFont('smooth-fancy')">è¿ç•…åä¸½ä½“</button>
                <button class="option-btn" onclick="changeFont('code')">ç­‰å®½å­—ä½“</button>
                <button class="option-btn" onclick="changeFont('art')">è‰ºæœ¯ä½“</button>
            </div>
            <button class="main-setting-btn" onclick="toggleOptionList('historyOptions')">å†å²è®°å½•</button>
            <div class="option-list" id="historyOptions">
                <div class="history-list" id="historyContainer">
                    <div class="history-item">æš‚æ— è®¡ç®—è®°å½•</div>
                </div>
                <button class="option-btn clear-history-btn" onclick="clearHistory()">æ¸…ç©ºè®°å½•</button>
            </div>
            <button class="main-setting-btn" onclick="toggleOptionList('makerOptions')">åˆ¶ä½œå‘˜</button>
            <div class="option-list" id="makerOptions">
                <div class="maker-text">è¯¥ç½‘ç«™ç”±Bç«™qué½¿ä½™åˆ¶ä½œï¼Œæ‰€æœ‰è§£é‡Šæƒå½’é½¿ä½™æ‹¥æœ‰</div>
            </div>
            <!-- ç¤¾åŒºæ¨¡å— -->
            <button class="main-setting-btn" onclick="toggleOptionList('communityOptions')">ç¤¾åŒº</button>
            <div class="option-list" id="communityOptions">
                <div class="community-item">
                    <div class="community-item-title">æ˜¥é‡èŠ±å›­ é…è‰²</div>
                    <div>åŒ¹é…å›¾ç‰‡æ ‡æ³¨é¢œè‰²+æµ…ç²‰/æµ…æ©™ä¼˜åŒ–</div>
                    <button class="community-download-btn" onclick="changeColor('spring-garden')">ä¸‹è½½ä½¿ç”¨</button>
                </div>
            </div>
            <button class="close-btn" onclick="closeSettings()">å…³é—­</button>
        </div>
    </div>
    <script>
        const settingsPage = document.getElementById('settingsPage');
        window.currentLang = 'ch'; 
        window.currentTheme = 'macaron'; 
        window.currentFont = 'default'; 
        window.calculationHistory = [];

        const fontCharMaps = {
            default: {},
            fancy: {
                '0': 'ğŸ', '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’',
                '5': 'ğŸ“', '6': 'ğŸ”', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—',
                'C': 'ğ‘ª', 'c': 'ğ‘ª'
            },
            'smooth-fancy': {
                '0': 'ğŸ', '1': 'ğŸ', '2': 'ğŸ', '3': 'ğŸ‘', '4': 'ğŸ’',
                '5': 'ğŸ“', '6': 'ğŸ”', '7': 'ğŸ•', '8': 'ğŸ–', '9': 'ğŸ—',
                'C': 'ğ“’', 'c': 'ğ“’'
            },
            code: {
                '0': 'ğŸ¶', '1': 'ğŸ·', '2': 'ğŸ¸', '3': 'ğŸ¹', '4': 'ğŸº',
                '5': 'ğŸ»', '6': 'ğŸ¼', '7': 'ğŸ½', '8': 'ğŸ¾', '9': 'ğŸ¿',
                'C': 'ğ™²', 'c': 'ğ™²'
            },
            art: {
                '0': 'ğŸ˜', '1': 'ğŸ™', '2': 'ğŸš', '3': 'ğŸ›', '4': 'ğŸœ',
                '5': 'ğŸ', '6': 'ğŸ', '7': 'ğŸŸ', '8': 'ğŸ ', '9': 'ğŸ¡',
                'C': 'â„‚', 'c': 'â„‚'
            }
        };

        const buttonTexts = {
            zh: {
                clear: 'ç©º',
                percent: 'å‡€',
                sqrt: 'æ ¹',
                divide: 'é™¤',
                multiply: 'ä¹˜',
                subtract: 'å»',
                add: 'å¢',
                decimal: 'é»',
                equal: 'å‡º',
                num0: 'é›¶',
                num1: 'å£¹',
                num2: 'è´°',
                num3: 'å',
                num4: 'è‚†',
                num5: 'ä¼',
                num6: 'é™†',
                num7: 'æŸ’',
                num8: 'æŒ',
                num9: 'ç–',
                settings: 'è®¾ç½®',
                title: 'å¤šåŠŸèƒ½è®¡ç®—å™¨',
                error: 'é½¿ä½™',
                noHistory: 'æš‚æ— è®¡ç®—è®°å½•',
                clearHistory: 'æ¸…ç©ºè®°å½•'
            },
            ch: {
                clear: 'C',
                percent: '%',
                sqrt: 'âˆš',
                divide: 'Ã·',
                multiply: 'Ã—',
                subtract: '-',
                add: '+',
                decimal: '.',
                equal: '=',
                num0: '0',
                num1: '1',
                num2: '2',
                num3: '3',
                num4: '4',
                num5: '5',
                num6: '6',
                num7: '7',
                num8: '8',
                num9: '9',
                settings: 'è®¾ç½®',
                title: 'è®¡ç®—å™¨',
                error: 'é½¿ä½™',
                noHistory: 'æš‚æ— è®¡ç®—è®°å½•',
                clearHistory: 'æ¸…ç©ºè®°å½•'
            },
            lm: {
                clear: 'C',
                percent: '%',
                sqrt: 'âˆš',
                divide: 'Ã·',
                multiply: 'Ã—',
                subtract: '-',
                add: '+',
                decimal: '.',
                equal: '=',
                num0: 'â…©',
                num1: 'â… ',
                num2: 'â…¡',
                num3: 'â…¢',
                num4: 'â…£',
                num5: 'â…¤',
                num6: 'â…¥',
                num7: 'â…¦',
                num8: 'â…§',
                num9: 'â…¨',
                settings: 'Settings',
                title: 'Multi-Function Calculator',
                error: 'qu',
                noHistory: 'No history',
                clearHistory: 'Clear History'
            },
            jp: {
                clear: 'ç„¡',
                percent: 'ï¼…',
                sqrt: 'âˆš',
                divide: 'å‰²',
                multiply: 'æ›',
                subtract: 'å¼•',
                add: 'è¶³',
                decimal: '.',
                equal: 'ï¼',
                num0: '0',
                num1: '1',
                num2: '2',
                num3: '3',
                num4: '4',
                num5: '5',
                num6: '6',
                num7: '7',
                num8: '8',
                num9: '9',
                settings: 'è¨­å®š',
                title: 'å¤šæ©Ÿèƒ½é›»å“',
                error: 'é½’ã®é¤˜',
                noHistory: 'è¨ˆç®—å±¥æ­´ãªã—',
                clearHistory: 'å±¥æ­´ã‚’æ¶ˆå»'
            },
            en: {
                clear: 'C',
                percent: '%',
                sqrt: 'âˆš',
                divide: 'Ã·',
                multiply: 'Ã—',
                subtract: '-',
                add: '+',
                decimal: '.',
                equal: '=',
                num0: '0',
                num1: '1',
                num2: '2',
                num3: '3',
                num4: '4',
                num5: '5',
                num6: '6',
                num7: '7',
                num8: '8',
                num9: '9',
                settings: 'Settings',
                title: 'Multi-Function Calculator',
                error: 'Error',
                noHistory: 'No calculation history',
                clearHistory: 'Clear History'
            }
        };

        function convertToCurrentFontText(text) {
            const charMap = fontCharMaps[window.currentFont];
            return text.split('').map(char => charMap[char] || char).join('');
        }

        function restoreOriginalText(text) {
            let original = text;
            const allCharEntries = Object.values(fontCharMaps).flatMap(map => Object.entries(map));
            allCharEntries.forEach(([orig, fancy]) => {
                original = original.split(fancy).join(orig);
            });
            return original;
        }

        function safeEvaluate(expression) {
            const validPattern = /^[\d+\-*/.%]+$/;
            if (!validPattern.test(expression)) return null;
            const processedExpr = expression.replace(/(\d+)%/g, '$1/100');
            try {
                return new Function(`return ${processedExpr}`)();
            } catch (e) {
                return null;
            }
        }

        function toggleOptionList(listId) {
            const targetList = document.getElementById(listId);
            document.querySelectorAll('.option-list').forEach(list => {
                if (list.id !== listId) list.style.display = 'none';
            });
            targetList.style.display = targetList.style.display === 'flex' ? 'none' : 'flex';
            if (listId === 'historyOptions') renderHistory();
        }

        function openSettings() {
            settingsPage.style.display = 'flex';
            document.querySelectorAll('.option-list').forEach(list => list.style.display = 'none');
        }

        function closeSettings() {
            settingsPage.style.display = 'none';
            document.querySelectorAll('.option-list').forEach(list => list.style.display = 'none');
        }

        function changeColor(theme) {
            const calculator = document.querySelector('.calculator');
            calculator.className = `calculator ${theme}`;
            if (window.currentFont !== 'default') {
                calculator.classList.add(`${window.currentFont}-font`);
            }
            window.currentTheme = theme;
            const settingsBtn = document.querySelector('.settings-btn');
            settingsBtn.textContent = convertToCurrentFontText(buttonTexts[window.currentLang].settings);
            closeSettings();
        }

        function changeFont(fontType) {
            const calculator = document.querySelector('.calculator');
            calculator.className = `calculator ${window.currentTheme}`;
            if (fontType !== 'default') {
                calculator.classList.add(`${fontType}-font`);
            }
            window.currentFont = fontType;
            const display = document.getElementById('display');
            display.value = convertToCurrentFontText(restoreOriginalText(display.value));
            updateButtonFonts();
            closeSettings();
        }

        function changeLanguage(lang) {
            const texts = buttonTexts[lang];
            document.title = texts.title;
            const settingsBtn = document.querySelector('.settings-btn');
            settingsBtn.textContent = convertToCurrentFontText(texts.settings);
            const buttons = document.querySelectorAll('.buttons button');
            buttons[0].textContent = convertToCurrentFontText(texts.clear);
            buttons[1].textContent = convertToCurrentFontText(texts.percent);
            buttons[2].textContent = convertToCurrentFontText(texts.sqrt);
            buttons[3].textContent = convertToCurrentFontText(texts.divide);
            buttons[4].textContent = convertToCurrentFontText(texts.num7);
            buttons[5].textContent = convertToCurrentFontText(texts.num8);
            buttons[6].textContent = convertToCurrentFontText(texts.num9);
            buttons[7].textContent = convertToCurrentFontText(texts.multiply);
            buttons[8].textContent = convertToCurrentFontText(texts.num4);
            buttons[9].textContent = convertToCurrentFontText(texts.num5);
            buttons[10].textContent = convertToCurrentFontText(texts.num6);
            buttons[11].textContent = convertToCurrentFontText(texts.subtract);
            buttons[12].textContent = convertToCurrentFontText(texts.num1);
            buttons[13].textContent = convertToCurrentFontText(texts.num2);
            buttons[14].textContent = convertToCurrentFontText(texts.num3);
            buttons[15].textContent = convertToCurrentFontText(texts.add);
            buttons[16].textContent = convertToCurrentFontText(texts.num0);
            buttons[17].textContent = convertToCurrentFontText(texts.decimal);
            buttons[18].textContent = convertToCurrentFontText(texts.equal);
            document.querySelector('.clear-history-btn').textContent = convertToCurrentFontText(texts.clearHistory);

            if (calculationHistory.length === 0) {
                document.getElementById('historyContainer').innerHTML = `<div class="history-item">${convertToCurrentFontText(texts.noHistory)}</div>`;
            } else {
                renderHistory();
            }

            window.currentLang = lang;
            closeSettings();
        }

        function updateButtonFonts() {
            const texts = buttonTexts[window.currentLang];
            const buttons = document.querySelectorAll('.buttons button');
            buttons[0].textContent = convertToCurrentFontText(texts.clear);
            buttons[1].textContent = convertToCurrentFontText(texts.percent);
            buttons[2].textContent = convertToCurrentFontText(texts.sqrt);
            buttons[3].textContent = convertToCurrentFontText(texts.divide);
            buttons[4].textContent = convertToCurrentFontText(texts.num7);
            buttons[5].textContent = convertToCurrentFontText(texts.num8);
            buttons[6].textContent = convertToCurrentFontText(texts.num9);
            buttons[7].textContent = convertToCurrentFontText(texts.multiply);
            buttons[8].textContent = convertToCurrentFontText(texts.num4);
            buttons[9].textContent = convertToCurrentFontText(texts.num5);
            buttons[10].textContent = convertToCurrentFontText(texts.num6);
            buttons[11].textContent = convertToCurrentFontText(texts.subtract);
            buttons[12].textContent = convertToCurrentFontText(texts.num1);
            buttons[13].textContent = convertToCurrentFontText(texts.num2);
            buttons[14].textContent = convertToCurrentFontText(texts.num3);
            buttons[15].textContent = convertToCurrentFontText(texts.add);
            buttons[16].textContent = convertToCurrentFontText(texts.num0);
            buttons[17].textContent = convertToCurrentFontText(texts.decimal);
            buttons[18].textContent = convertToCurrentFontText(texts.equal);
            document.querySelector('.clear-history-btn').textContent = convertToCurrentFontText(texts.clearHistory);
        }

        function appendToDisplay(value) {
            const display = document.getElementById('display');
            display.value += convertToCurrentFontText(value);
        }

        function clearDisplay() {
            document.getElementById('display').value = '';
        }

        function calculateSquareRoot() {
            const display = document.getElementById('display');
            const originalValue = restoreOriginalText(display.value);
            const texts = buttonTexts[window.currentLang];
            const value = safeEvaluate(originalValue);
            if (value !== null && !isNaN(value) && value >= 0) {
                const result = Math.sqrt(value);
                display.value = convertToCurrentFontText(result.toString());
                addToHistory(`${originalValue} âˆš = ${result}`);
            } else {
                display.value = convertToCurrentFontText(texts.error);
            }
        }

        function calculateResult() {
            const display = document.getElementById('display');
            const originalValue = restoreOriginalText(display.value);
            const texts = buttonTexts[window.currentLang];
            const result = safeEvaluate(originalValue);
            if (result !== null && !isNaN(result)) {
                display.value = convertToCurrentFontText(result.toString());
                addToHistory(`${originalValue} = ${result}`);
            } else {
                display.value = convertToCurrentFontText(texts.error);
            }
        }

        function addToHistory(record) {
            if (calculationHistory.length >= 10) calculationHistory.shift();
            calculationHistory.push(record);
            if (document.getElementById('historyOptions').style.display === 'flex') renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('historyContainer');
            const texts = buttonTexts[window.currentLang];
            if (calculationHistory.length === 0) {
                container.innerHTML = `<div class="history-item">${convertToCurrentFontText(texts.noHistory)}</div>`;
                return;
            }
            container.innerHTML = '';
            calculationHistory.reverse().forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.textContent = convertToCurrentFontText(item);
                container.appendChild(historyItem);
            });
            calculationHistory.reverse();
        }

        function clearHistory() {
            calculationHistory = [];
            const texts = buttonTexts[window.currentLang];
            document.getElementById('historyContainer').innerHTML = `<div class="history-item">${convertToCurrentFontText(texts.noHistory)}</div>`;
        }

        window.onclick = function(event) {
            if (event.target === settingsPage) closeSettings();
        }

        changeLanguage(window.currentLang);
        changeColor(window.currentTheme);
        changeFont(window.currentFont);
    </script>
<pre>
ç‰ˆæœ¬å·2.0.5
æ­£å¼ç‰ˆ1.2.0
ä¿®å¤å·²çŸ¥ç‰¹æ€§
æ·»åŠ ç¤¾åŒº
</pre>
</body>
</html>